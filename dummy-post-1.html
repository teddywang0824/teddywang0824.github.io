<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dummy Post #1 - Nobody's Blog</title>
    <link rel="stylesheet" href="./theme/css/style.css?v=1.1" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Serif+TC:wght@300;400;600&family=Dancing+Script:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body>
    <header class="site-header">
        <div class="header-inner">
            <h1 class="site-title"><a href="./">Nobody's Blog</a></h1>
            <nav class="site-nav">
                <ul>
                    <li><a href="./">首頁</a></li>
                    <li><a href="./category/inspiration.html">生活與靈感</a></li>
                    <li><a href="./category/programming.html">程式與科技</a></li>
                    <li><a href="./pages/about.html">關於我</a></li>
                </ul>
            </nav>
        </div>
    </header>


    <main class="site-main">
<article class="single-post">
    <header class="post-header">
        <div class="post-category">
            <a href="./category/inspiration.html">Inspiration</a>
        </div>
        <h1 class="post-title">Dummy Post #1</h1>
        <div class="post-meta">
            <span class="date">Nov 25, 2025</span>
            <span class="meta-separator">·</span>
            <span class="read-time">☕️ 1 min read</span>
        </div>
    </header>


    <div class="post-body">
        <h1>Dummy Post #1</h1>
<p>這是一篇自動生成的測試文章。</p>
<h2>內容章節</h2>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. </p>
<h3>子標題</h3>
<p>Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        
        <div class="end-mark">
            <span>·</span><span>·</span><span>·</span>
        </div>
    </div>

    <div class="post-footer">
        <div class="post-tags">
        </div>

        <div class="author-bio" onclick="window.location.href='./pages/about'" style="cursor: pointer">
            <div class="author-avatar">
                <img src="./theme/images/profile.jpg" alt="Chia Yuan">
            </div>
            <div class="author-info">
                <h4>Chia Yuan</h4>
                <p>A Nobody who loves to try different things.</p>
            </div>
        </div>

        <div id="comments-section" class="comments-section">
            <h3>留言板</h3>
            
            <div id="comment-list" class="comment-list">
                <p class="loading-text">載入留言中...</p>
            </div>

            <form id="comment-form" class="comment-form">
                <input type="text" id="name" placeholder="暱稱" required class="comment-input">
                <textarea id="content" placeholder="寫下你的留言..." required class="comment-textarea"></textarea>
                <button type="submit" class="comment-submit-btn">送出留言</button>
            </form>
        </div>

        <div class="post-navigation">
        </div>
    </div>
</article>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, orderBy, onSnapshot, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";

  // 1. 貼上你的 Firebase Config
  // 請到 Firebase Console > Project Settings > General > Your apps 複製設定
  const firebaseConfig = {
    apiKey: "AIzaSyDwGcqOZctTprEDddbGKKid7dgu4lOCb2Y",
    authDomain: "nobody-s-blog-comment.firebaseapp.com",
    projectId: "nobody-s-blog-comment",
    storageBucket: "nobody-s-blog-comment.firebasestorage.app",
    messagingSenderId: "1085772418942",
    appId: "1:1085772418942:web:00f337e41831f8efeaed2f",
    measurementId: "G-P3PBN9CLRP"
  };

  // 2. 初始化
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  
  // 取得目前文章的唯一識別 (Slug)
  const articleSlug = "dummy-post-1"; 

  const commentsRef = collection(db, "comments");
  const q = query(
      commentsRef, 
      where("slug", "==", articleSlug), 
      orderBy("createdAt", "desc")
  );

  // 3. 監聽留言
  const list = document.getElementById("comment-list");
  onSnapshot(q, (snapshot) => {
      let html = "";
      if (snapshot.empty) {
          html = "<p class='no-comments'>目前還沒有留言，搶頭香！</p>";
      } else {
          snapshot.forEach((doc) => {
              const data = doc.data();
              const name = data.name ? data.name.replace(/</g, "&lt;") : "匿名"; 
              const content = data.content ? data.content.replace(/</g, "&lt;") : "";
              const date = data.createdAt ? new Date(data.createdAt.seconds * 1000).toLocaleString() : '剛剛';
              
              html += `
                  <div class="comment-item">
                      <div class="comment-header">
                          <span class="comment-author">${name}</span>
                          <span class="comment-date">${date}</span>
                      </div>
                      <p class="comment-content">${content}</p>
                  </div>
              `;
          });
      }
      list.innerHTML = html;
  });

  // 4. 送出留言
  const form = document.getElementById("comment-form");
  form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const content = document.getElementById("content").value;
      const btn = form.querySelector("button");

      if(!name || !content) return;

      btn.disabled = true;
      btn.innerText = "送出中...";

      try {
          await addDoc(commentsRef, {
              slug: articleSlug,
              name: name,
              content: content,
              createdAt: serverTimestamp()
          });
          form.reset(); 
      } catch (error) {
          console.error("Error adding comment: ", error);
          alert("留言失敗，請檢查網路設定或 Firebase Config");
      } finally {
          btn.disabled = false;
          btn.innerText = "送出留言";
      }
  });
</script>
    </main>

    <footer class="site-footer">
        <div class="footer-inner">
            <p class="motto">在縫隙中撿拾光影</p>
            <p class="copyright">&copy;  Chia Yuan. Powered by <a href="https://getpelican.com/">Pelican</a>.</p>
            <a href="#" class="back-to-top">↑</a>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Smart Header Logic
            let lastScrollTop = 0;
            const header = document.querySelector('.site-header');
            const scrollThreshold = 100; // Minimum scroll before hiding

            window.addEventListener('scroll', function() {
                let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > lastScrollTop && scrollTop > scrollThreshold) {
                    // Scroll Down
                    header.classList.add('hidden');
                } else {
                    // Scroll Up
                    header.classList.remove('hidden');
                }
                lastScrollTop = scrollTop <= 0 ? 0 : scrollTop; // For Mobile or negative scrolling
            });

            // Nav Background Logic
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                const bgUrl = link.getAttribute('data-bg');
                if (bgUrl) {
                    const bgDiv = link.querySelector('.nav-bg');
                    if (bgDiv) {
                        bgDiv.style.backgroundImage = `url(${bgUrl})`;
                    }
                }
            });
        });
    </script>
</body>
</html>